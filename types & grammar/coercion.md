# ç±»å‹è½¬æ¢(Coercion)

## å¼ºåˆ¶è½¬æ¢(type casting/conversion) VS éšå¼è½¬æ¢(type coercion)
- æœ€å¤§çš„åŒºåˆ«åœ¨äº å¼ºåˆ¶è½¬æ¢ä¸€èˆ¬æ˜¯é™æ€ç±»å‹çš„è¯­è¨€å‘ç”Ÿåœ¨ç¼–è¯‘æ—¶(compile time)ï¼Œéšå¼è½¬æ¢ä¸€èˆ¬æ˜¯åŠ¨æ€ç±»å‹çš„è¯­è¨€å‘ç”Ÿåœ¨è¿è¡Œæ—¶(runtime)
- å¯¹äºJSæ¥è¯´, å…³äºæ˜¾ç¤ºå’Œéšå¼è½¬åŒ–ï¼Œå¹¶æ²¡æœ‰æ¸…æ™°çš„å®šä¹‰ã€‚ä½†é€šå¸¸æ¥è®²ï¼Œå¦‚æœä½ æ¸…æ™°çš„çŸ¥é“æŸä¸ªå†™æ³•ä¼šè¢«coercionï¼Œé‚£å¯¹ä½ è€Œè¨€ï¼Œè¿™å°±æ˜¯æ˜¾ç¤ºè½¬æ¢

----

## JSä¸­çš„æŠ½è±¡è¿ç®—(Abstract Operation / Internel-Only Operation)

### ToPrimitive
- ä½¿ç”¨ `valueOf(...) & toString(...)` å°†å¤æ‚ç±»å‹è½¬æ¢æˆåŸå§‹ç±»å‹ï¼Œ*valueOf*çš„ä¼˜å…ˆçº§é«˜äº*toString*ï¼Œå¦‚æœä¸¤ä¸ªæ–¹æ³•éƒ½ä¸å¯ç”¨ï¼Œä¼šæŠ›å‡º*TypeError*
  ```javascript
  var a = Object.create(null);
  +a; // TypeError
  ```

### ToString
- åŸå§‹å€¼å˜æˆstringï¼ŒåŸºæœ¬éƒ½æ˜¯æ·»åŠ å¼•å·çš„è¿‡ç¨‹''

- ç‰¹åˆ«å¤§çš„æ•°å­—è½¬æ¢æˆstringæ—¶ä¼šä»¥æŒ‡æ•°çš„å½¢å¼è¡¨ç¤ºæ•°å­—ï¼Œç„¶åå†è½¬æˆstring

#### toString(...)
- å¸¸è§„çš„å¯¹è±¡è½¬æˆstringï¼Œä¸€èˆ¬éƒ½æ˜¯è°ƒç”¨Object.prototype.toStringçš„æ–¹æ³•ï¼Œè¿”å›å¸¦æœ‰ç±»çš„å­—ç¬¦ä¸²

- å¦‚æœå¯¹è±¡è‡ªå®šä¹‰äº†toStringæ–¹æ³•ï¼Œé‚£ä¹ˆå½“å¯¹è±¡è¢«ç”¨äºå­—ç¬¦ä¸²ç›¸å…³çš„æ“ä½œæ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨è¿™ä¸ªè‡ªå®šä¹‰çš„æ–¹æ³•ï¼Œå¹¶è¿”å›å®šä¹‰çš„å€¼

- æ€»è€Œè¨€ä¹‹ï¼ŒtoStringèƒ½å¤Ÿæ˜¾ç¤ºè°ƒç”¨ï¼Œä¹Ÿä¼šåœ¨éstringçš„å€¼åœ¨è¢«ç”¨äºéœ€è¦stringçš„ä¸Šä¸‹æ–‡ä¸­è¢«è°ƒç”¨

#### String(...)
- ä¸å¸¦å…³é”®å­— `new` è°ƒç”¨Stringæ–¹æ³•ä¼šæ˜¾ç¤ºçš„å°†ä¼ å…¥çš„å€¼è½¬æ¢æˆå­—ç¬¦ä¸²

#### JSON.stringify(...)
- ä¸€èˆ¬è®²ï¼Œåºåˆ—åŒ–(stringification)çš„è¡Œä¸ºå’ŒtoStringç±»ä¼¼ï¼Œä½†æ˜¯æ“ä½œå·²ç»æ˜¯å­—ç¬¦ä¸²çš„å€¼æ—¶ï¼Œåºåˆ—åŒ–ä¼šå†æ·»åŠ å¼•å·
  ```javascript
  JSON.stringify('123'); // ""123""
  ```

- å…³äºJSON-safe
  * æœ‰æ•ˆçš„JSONå€¼å³ä¸ºJSON-safe

  * éJSON-safe
    1. undefined
    2. function
    3. symbol
    4. object with circular references - å¾ªç¯å¼•ç”¨

  * å¯¹äºé JSON-safeçš„å€¼
    + å¦‚æœå‡ºç°åœ¨æ•°ç»„ä¸­ï¼Œä¼šè¢«è½¬æ¢æˆnull
    ```javascript
    JSON.stringify([1, undefined, function () {}, 55]); // [1, null, null, 55]
    ```

    + å¦‚æœå‡ºç°åœ¨å¯¹è±¡ä¸­ï¼Œä¼šç›´æ¥è¢«çœç•¥
    ```javascript
    JSON.stringify({
      a: 1,
      b: function () {},
      c: undefined
    }); // {a: 1}
    ```

    + ç›´æ¥è½¬åŒ–ï¼Œåˆ™éƒ½ä¸ºundefined
    ```javascript
    JSON.stringify(function () {}); // undefined
    ```
  
    + å¦‚æœå‡ºç°å¾ªç¯å¼•ç”¨ï¼Œä¼šæŠ¥é”™
    ```javascript
    var o = {};
    var a = { b: 33, c: o, d: function () {} };
    o.e = a;
    JSON.stringify(a); // TypeError ...
    ```
    ![avatar](./assets/coercion_circular_references.png)

  * toJSON
    + å¦‚æœä¸€ä¸ªå¯¹è±¡å®šä¹‰äº†toJSONçš„æ–¹æ³•ï¼Œé‚£ä¹ˆåœ¨åšåºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šè¢«å”¤èµ·å¹¶å†³å®šå“ªäº›å€¼ä¼šè¢«åºåˆ—åŒ–
    ```javascript
    var a = { b: 33, c: o, d: function () {} };
    a.toJSON = function () {
      return { b: this.b };
    };
    JSON.stringify(a); // "{"b": 42}"
    ```

    + toJSON è¿”å›çš„å€¼å¹¶ä¸éœ€è¦åºåˆ—åŒ–ï¼Œè¿”å›æ­£å¸¸ç±»å‹å€¼å³å¯ï¼Œå› ä¸ºæœ€åçš„æ­¥éª¤è¿˜æ˜¯éœ€è¦äº¤ç»™JSON.stringify, è€ŒtoJSONåªæ˜¯å†³å®šäº†é‚£äº›å€¼ä¼šè¢«åºåˆ—åŒ– â€”â€” å› æ­¤toJSONè¢«ç¿»è¯‘æˆ 'to a JSON-safe value suitable for stringification' æ›´åˆé€‚

  * JSON.stringify æ¥å—ç¬¬äºŒä¸ªå‚æ•°ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªæ•°ç»„æˆ–ä¸€ä¸ªå‡½æ•°
    + åºåˆ—åŒ–ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œç¬¬äºŒå‚æ•°ä¼ é€’çš„æ•°ç»„é‡Œé¢æŒ‡å®šçš„é”®ä¼šè¢«åºåˆ—åŒ–ï¼Œè€Œæœªè¢«æŒ‡å®šçš„åˆ™è·³è¿‡ï¼Œå¦‚æœè¯¥é”®ä¸å­˜åœ¨ï¼Œä¹Ÿè·³è¿‡
    ```javascript
    var a = { b: 22, c: 33, d: [4,5,6] };
    JSON.stringify(a, [b, c]);
    ```

    + åºåˆ—åŒ–ä¸€ä¸ªå¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å‡½æ•°æ—¶ï¼Œä¼šéå†è¿™ä¸ªå¯¹è±¡ï¼Œå¹¶åœ¨å‡½æ•°é‡Œé¢æ¥å—keyå’Œvalueçš„å‚æ•°ï¼Œè¿”å›å…¶å€¼åˆ™ä»£è¡¨è¿›è¡Œåºåˆ—åŒ–ï¼Œå¯¹äºä¸æƒ³åºåˆ—åŒ–çš„é”®ï¼Œè¿”å›undefinedå³å¯
    ```javascript
    var a = { b: 22, c: 33, d: [4,5,6] };
    JSON.stringify(a, function (k ,v){
      console.log(k);
      if (k !== 'c') return v;
    });
    // å¯ä»¥è§‚å¯Ÿåˆ°ï¼Œç¬¬ä¸€æ¬¡kæ˜¯undefinedï¼Œè¿™æ˜¯å› ä¸ºéå†çš„æ˜¯aå¯¹è±¡è‡ªèº«ï¼›
    // è€Œåç»­è¿˜ä¼šæ‰“å°0 1 2ï¼Œè¿™æ˜¯é€’å½’dæ•°ç»„ï¼Œå–å…¶ç´¢å¼•ä¸ºkå¯¼è‡´çš„
    ```

  * JSON.stringify çš„ç¬¬ä¸‰ä¸ªå‚æ•°èƒ½æ ¼å¼åŒ–è¾“å‡º
    + å¦‚æœä¼ å…¥ä¸€ä¸ªæ•°å­—ï¼Œåˆ™ä»£è¡¨æœ‰å¤šå°‘ä¸ªç©ºæ ¼ä¼šè¢«ç”¨äºæ¯ä¸€ä¸ªç¼©è¿›çº§åˆ«
    ```javascript
    var a = {b: 22, c: 33, d: [4,5,6]};
    JSON.stringify(a, null, 3);
    ```

    + å¦‚æœä¼ å…¥ä¸€ä¸ªå­—ç¬¦ï¼Œé‚£ä¹ˆè¯¥å­—ç¬¦çš„å‰åä¸ª(å¦‚æœæœ‰é‚£ä¹ˆå¤š)ä¼šè¢«ä½œä¸ºç¼©è¿›
    ```javascript
    var a = {b: 22, c: 33, d: [4,5,6]};
    JSON.stringify(a, null, '-----');
    ```

### ToNumber
#### Number(...)
```javascript
true --> 1
false --> 0
undefined --> NaN
null --> 0
'' --> 0
[] --> 0
[''] --> 0
[5] --> 5
['5'] --> 5
['a'] --> NaN
[1, 2] --> NaN
```

### ToBoolean
#### Boolean(...)
- **falsy** - ä»»ä½•ä¼šè¢« `Boolean(...)` è½¬æ¢æˆ `false` çš„å€¼(the value will coerce to false)
  ```javascript
  undefined
  null
  false
  +0 -0
  NaN
  ''
  ```

- **truthy** - ä»»ä½•ä¸å±äº `falsy` çš„å€¼éƒ½æ˜¯ `truthy`(anything not explicitly on the falsy list is therefore truthy)

- çœ‹ä¸‹é¢ä¸¤æ®µä»£ç , ä½“ä¼šä¸‹é€šè¿‡*åŒ…è£…å¯¹è±¡*è¿›å’Œ*å­—é¢é‡*è¡Œè½¬æ¢åçš„å€¼çš„åŒºåˆ«
  ```javascript
  var a = new String('');
  var b = new Number(0);
  var c = new Boolean(false);

  var d = Boolean(a && b && c);
  d; //true
  var e = a && b && c;
  e; // String ''
  ```

  ```javascript
  var a = "''";
  var b = '0';
  var c = 'false';

  var d = Boolean(a && b && c);
  d; //true
  ```

- **falsy object**
  ```javascript
  document.all; // ä¸ºäº†åŒºåˆ«è€æ—§çš„IEæµè§ˆå™¨ï¼Œå¤§éƒ¨åˆ†ç°ä»£æµè§ˆå™¨éƒ½å°†document.all éšå¼è½¬æ¢æˆbooleanå€¼çš„æ—¶å€™ç½®ä¸ºfalse
  !!document.all; // false
  ```

----

## æ˜¾ç¤ºè½¬æ¢(Explicit Coercion)
### String <--> Number
#### ä½¿ç”¨built-in native constructors(ä½†æ˜¯ä¸åŠ å…³é”®å­—newï¼Œæ„å‘³ç€ä¸å®ä¾‹åŒ–äº§ç”ŸåŒ…è£…å¯¹è±¡)
```javascript
var a = 32;
var b = String(a);

var c = '123';
var d = Number(c);
```

#### ä½¿ç”¨toString()æ–¹æ³•ã€+å·ã€-å·è¿ç®—ç¬¦è¿›è¡Œè½¬æ¢
```javascript
var a = 32;
var b = a.toString();
var b1 = '' + a;

var c = '123';
var d = +c;
// toString()æ–¹æ³•è¡¨é¢ä¸Šçœ‹èµ·æ¥æ˜¯æ˜¾ç¤ºè½¬æ¢ï¼Œä½†æ˜¯32.toString()æ˜¾ç„¶ä¼šæŠ¥é”™ï¼Œè€Œa.toString()æ˜¯å°†aå…ˆç”¨å¯¹è±¡åŒ…è£¹èµ·æ¥ï¼Œç„¶åè¿›è¡Œè°ƒç”¨ï¼Œå¯ä»¥ç†è§£ä¸ºæ˜¾ç¤ºä¸­çš„éšå¼è½¬æ¢
```

```javascript
var a = '3';
var b = 5+ +a;

b; //8
```

```javascript
var c = '7';
var d = - -c;

d; //7
```

```javascript
var a = '4';
var b = 5;

b =+ a ; //4
b += a; //'54'
```

```javascript
var a = 4;
var b = '5';

a +++b; //'45'
a; // 5
b; // '5'

a + ++b; // 10
a; // 4
b; // 6

a + + +b; // 9
a; // 4;
b; // '5'
```

#### parseInt(...) å’Œ parseFloat(...)
```javascript
parseInt('42px'); // 42
```
- å’ŒNumber(..)ä¸åŒï¼ŒparseInt(...)ä¸ä¼šå…³å¿ƒå­—ç¬¦ä¸²æ•´ä½“æ˜¯å¦æ˜¯æ•°å­—å­—ç¬¦(numeric characters)ï¼Œå®ƒåªä¼šä»å·¦å¾€å³æ‰¾åˆ°æ•°å­—å­—ç¬¦è¿›è¡Œè½¬æ¢

- å¦‚æœä»¥0Xæˆ–0xå¼€å¤´ï¼Œä¼šè¢«è®¤ä¸ºæ˜¯16è¿›åˆ¶è½¬æ¢ä¸º10è¿›åˆ¶ï¼Œå¦‚æœä»¥0å¼€å¤´ï¼Œåˆ™ä¼šè®¤ä¸ºæ˜¯8è¿›åˆ¶è½¬æ¢æˆ10è¿›åˆ¶
  * å› æ­¤å¯¹äºæ—¶é—´çš„è½¬æ¢(æ—¶åˆ†ç§’)ï¼Œéœ€è¦ä½¿ç”¨ç¬¬äºŒä¸ªå‚æ•°ï¼Œå³æŒ‡å®šè½¬æ¢çš„è¿›åˆ¶æ•°(radix)

  * åœ¨ES5ä»¥åï¼Œé»˜è®¤ä¸ä¼šæœ‰8è¿›åˆ¶çš„è½¬æ¢ï¼Œåªæœ‰10å’Œ16è¿›åˆ¶ï¼Œå› æ­¤åªéœ€è¦æ³¨æ„åœ¨ES5ä»¥å‰çš„ç¯å¢ƒä¸­ä½¿ç”¨parseIntè½¬æ¢0å¼€å¤´çš„å­—ç¬¦æ•°å­—å³å¯
  ```javascript
  parseInt(1/0, 19); // 18
  parseInt('b'); // NaN
  parseInt('b', 12); // 11
  // base-19ï¼Œæœ‰æ•ˆçš„æ•°å­—å­—ç¬¦æ˜¯0-9å’Œa-iï¼Œå› æ­¤ 1/0 --> Infinity ç¬¬ä¸€ä¸ªå­—ç¬¦iä¼šè¢«è§£æï¼Œé‡åˆ°ç¬¬äºŒä¸ªå­—ç¬¦nåˆ™ä¼šåœæ­¢ï¼Œå› æ­¤æœ€ç»ˆçš„ç»“æœæ˜¯18
  ```

  ```javascript
  parseInt( 0.000008 ); //0
  parseInt( 0.0000008 ); //8 (0.0000008 --> 8e-7)
  parseInt( false, 16 ); //250
  parseInt( Array.prototype.map, 16 ); //15 ('f' from 'function')
  parseInt( "0x10" ); //16
  parseInt( "103", 2 ); //2
  ```

### Date <--> Number
```javascript
let timestamp = +new Date();
timestamp = +new Date;
timestamp = new Date().getTime();
timestamp = Date.now()
```

### bitwise operators (ä½è¿ç®—ç¬¦)
- ä½è¿ç®—ç¬¦åœ¨JSä¸­åªæ”¯æŒ`ToInt32`è§„åˆ™ï¼Œå¦‚æœè¶…è¿‡äº†32-bitï¼Œåˆ™è¿ç®—çš„ç»“æœä¼šè¢«coercionæˆ32ä½çš„æ•°å­—

- `~` è¿ç®—ç¬¦å…ˆå°†æ“ä½œæ•°è½¬æ¢æˆ32-bitçš„æ•°å­—ï¼Œç„¶åæŒ‰ä½æ±‚å(performs a bitwise negation) â€”â€” ç¿»è½¬å¥‡å¶æ€§(flipping each bit's parity)
  * -1 å¸¸è¢«ç”¨ä½œæ ‡è®°å€¼ï¼Œä½¿ç”¨ ~-1 ä¼šå¾—åˆ°0ï¼Œè€Œè¿™ä¸ªfalsy å€¼èƒ½å¤Ÿè¢«coercion, å› æ­¤åœ¨å†™æ³•ä¸Šèƒ½å¤Ÿæ›´è¯­ä¹‰åŒ–

  * `~~` è¿ç»­ä½¿ç”¨ä¸¤ä¸ªæŒ‰ä½éè¿ç®—ç¬¦ï¼Œèƒ½å¤Ÿå®ç°æˆªæ–­æ•°å­—ï¼Œä½¿ä¹‹æˆä¸ºæ•´å‹ç±»å‹ï¼Œå¹¶ä¸”ä¿ç•™æ­£è´Ÿå·ï¼›
ä½†æ˜¯å®ƒå’ŒMath.floor()æœ‰å¾ˆå¤§åŒºåˆ«ï¼Œå‰è€…æ˜¯æŒ‰ç…§32-bitè§„åˆ™å»æ‰§è¡Œè¿ç®—çš„ï¼Œåè€…åˆ™æ»¡è¶³64-bitçš„æ ‡å‡†ï¼›å¹¶ä¸”åœ¨å¯¹è´Ÿæ•°è¿›è¡Œæˆªæ–­(truncate)æ—¶ï¼Œ~~è¡¨ç°çš„ç»“æœå’ŒMathi.ceilä¸€è‡´
  ```javascript
  var a = Math.pow(2, 32) + 0.55;

  ~~a; //0
  Math.floor(a); // 4294967296

  var b = -49.6;

  ~~b; //-49
  Math.floor(b); // -50
  Math.ceil(b); // -49

  //ä½¿ç”¨æŒ‰ä½æˆ– | ä¹Ÿèƒ½å®ç°ç›¸åŒçš„æ•ˆæœ
  var b = -49.6;
  b | 0; // -49
  ```

### * --> boolean
- Boolean(...); ä¸å¸¦newå…³é”®å­—ä½¿ç”¨å†…å»ºçš„æ–¹æ³•ï¼Œè™½ç„¶å¾ˆâ€œæ˜¾â€(explicit)ï¼Œä½†æ˜¯å¹¶ä¸å¸¸ç”¨

- unary `!` æ“ä½œç¬¦ æ›´ä¸ºå¸¸ç”¨

- `?:` ä¸‰å…ƒè¿ç®—ç¬¦ã€`if(...)` ä¼šå°†æ¡ä»¶å‚æ•°éšå¼è½¬åŒ–æˆboolean

----

## éšå¼è½¬æ¢(Implicit Coercion)
+ JS implicit coercionçš„ç›®çš„æ˜¯: å‡å°‘å†—ä½™çš„ã€æ ·æ¿æ–‡ä»¶ã€ä¸å¿…è¦çš„æ‰§è¡Œç»†èŠ‚ï¼Œé¿å…ä»£ç è¢«å„ç§å™ªå£°è½¬ç§»æ³¨æ„ï¼Œæ›´æ¸…æ™°çš„æ˜¾ç¤ºä»£ç æœ¬æ¥çš„æ„å›¾

+ æŸäº›åœºæ™¯ä¸‹çœç•¥æˆ–è€…æŠ½ç¦»ç±»å‹è½¬æ¢çš„ç»†èŠ‚ï¼Œåè€Œæœ‰åŠ©äºä»£ç çš„é˜…è¯»æ€§

+ JSçš„éšå¼è½¬æ¢æ€»ä¼šæŠŠå€¼å˜æˆåŸå§‹ç±»å‹çš„å€¼ï¼Œè€Œéå¤æ‚ç±»å‹çš„å€¼

### String <--> Number
1. `+` è¿ç®—ç¬¦
    ```javascript
    [1,2] + [3,4]; // '1,23,4'

    {a: 1} + {b: 2}; // '[object Object][object Object]'
    ```
    - æ ¹æ®ES5 spec, + è¿ç®—ç¬¦å¦‚æœé‡åˆ°äº†ä¸€ä¸ªåŠä»¥ä¸Šstringç±»å‹çš„æ“ä½œæ•°ï¼Œä¼šè‡ªåŠ¨è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥

    - å¦‚æœæ“ä½œæ•°æœ‰å¯¹è±¡æ—¶ï¼Œä¼šå…ˆå°†å¯¹è±¡valueOf(...)è½¬æ¢æˆæ•°å­—, ä½†é»˜è®¤çš„valueOfæ–¹æ³•ä¸ä¼šæˆåŠŸè½¬æˆåŸå§‹å€¼, å› æ­¤æœ€ç»ˆä¼šè°ƒç”¨toString(...)çš„æ–¹æ³•è½¬æ¢æˆåŸå§‹å€¼å­—ç¬¦ä¸²

    ```javascript
    [] + {}; // '[object Object]'

    {} + []; // 0
    ```

    ```javascript
    "" + 3; // "3"
    ```

  - "" + 3; å’Œ String(3); çš„åŒºåˆ«æ˜¯ï¼šå‰è€…å…ˆè°ƒç”¨valueOf(...)æ–¹æ³•ï¼Œç„¶åå°†å…¶å€¼è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œåè€…åˆ™æ˜¯ç›´æ¥è°ƒç”¨toString(...)æ–¹æ³•
    ```javascript
    var a = {
      valueOf: function () { return 42; },
      toString: function () { return 2; }
    };

    a + ''; // '42'
    String(a); // '2'
    ```

    ```javascript
    var a = "3";
    var b = +a;

    b; // 3
    ``` 

2. `- * /` è¿ç®—ç¬¦
    ```javascript
    var a = '3.14';
    var b = a - 0;
    var c = a * 1;
    var d = a / 1;

    b; // 3.14
    c; // 3.14
    d; // 3.14
    ```

    ```javascript
    var a = [3];
    var b = [1];

    a - b; // 2
    ```
    - å’Œ + è¿ç®—ç¬¦ä¸åŒçš„æ˜¯ï¼Œ- è¿ç®—ç¬¦ä¸ä¼šè¿›è¡Œå­—ç¬¦ä¸²çš„åˆ å‡ï¼Œè€Œä¼šå°†å­—ç¬¦ä¸²è½¬æ¢æˆæ•°å­—åè¿›è¡Œæ•°å­¦è¿ç®—ï¼›

    - é’ˆå¯¹**var a = [3];** å…ˆä¼šè¿›è¡Œ`valueOf(...)`ï¼Œä½†æ˜¯æ­¤æ—¶çš„ç»“æœä¸æ˜¯åŸå§‹å€¼ï¼Œç„¶åè°ƒç”¨`toString(...)`æ–¹æ³•ï¼Œè½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œæœ€åå†è½¬æ¢æˆæ•°å­—è¿›è¡Œæ•°å­¦è¿ç®—

### Boolean --> Number
- boolean åˆ° number ä¸»è¦æ˜¯åŸºäº + - * / ç­‰è¿ç®—ç¬¦
  ```javascript
  var a = true;
  var b = false;

  a * 33; // 33
  b * 33; // 0
  ```

- number åˆ° boolean åˆ™æ˜¯ç”¨ ! è¿ç®—ç¬¦
  ```javascript
  var a = 2;
  var b = 0;

  !!a; // true
  !!b; // false
  ```

- ä¼ å…¥ä»»æ„å‚æ•°ï¼Œå¦‚æœæœ‰ä¸”åªæœ‰ä¸€ä¸ªå‚æ•°æ˜¯truthyï¼Œåˆ™è¿”å›trueï¼Œå¦åˆ™è¿”å›false
  ```javascript
  function onlyOne () {
    let sum = 0;
    const len = arguments.length;
    for (let i = 0; i < len; i++) {
      sum += !!arguments[i];
    };
    return sum === 1;
  };
  // åˆ©ç”¨ += å’Œ !! è¿ç®—ç¬¦è¿›è¡Œéšå¼è½¬æ¢ï¼Œå…ˆå°†ä»»æ„å‚æ•°é€šè¿‡!!è½¬æ¢æˆbooleanï¼Œç„¶åç”¨+=å°†å…¶è½¬æ¢æˆæ•°å­—ï¼Œtrueä¸º1, falseä¸º0;
  // åˆ™æœ€ç»ˆsumç»“æœæ»¡è¶³1ï¼Œåˆ™è¯´æ˜åªæœ‰ä¸€ä¸ªä¼ å…¥çš„å€¼æ˜¯truthy
  ```

### * --> Boolean
- booleanå€¼éšå¼è½¬æ¢çš„è§¦å‘ç‚¹
  1. `if (...)`
  2. `for(...; ...; ...;);` ç¬¬äºŒä¸ªæ¡ä»¶
  3. `while(...)` å’Œ `do...while(...)`
  4. `(...)?(...):(...)` ç¬¬ä¸€ä¸ªæ¡ä»¶
  5. `||` å’Œ `&&` çš„å·¦ä¾§æ“ä½œæ•°

- `||` å’Œ `&&`
  * é€šå¸¸å®šä¹‰ä¸ºlogical operators, ä½†å®šä¹‰ä¸ºoperand selector operatorsæ›´ä¸ºæ°å½“, å› ä¸ºå®ƒä»¬ä¼šé€‰æ‹©ä¸€ä¸ª(only one)çš„æ“ä½œæ•°ä½œä¸ºè¿”å›å€¼ï¼Œè€Œä¸æ˜¯å®ƒä»¬è¿ç®—çš„å¸ƒå°”å€¼
    ```javascript
    a || b;
    a ? a : b;

    a && b;
    a ? b : a;
    ```

  * ä»ç»“æœæ¥çœ‹ï¼Œ|| å’Œ && ä¸ ?: ä¸‰å…ƒè¿ç®—ç¬¦ä¿æŒä¸€è‡´ï¼›åŒºåˆ«åœ¨äºå®ƒä»¬çš„è¿è¡Œè¿‡ç¨‹ï¼Œæ¯”å¦‚a || b å¦‚æœaä¸ºtruthyï¼Œé‚£ä¹ˆåªä¼šå¯¹aè¿›è¡Œä¸€æ¬¡evaluatedï¼Œå¦‚æœæ˜¯a ? a : bï¼Œaä¼šè¿›è¡Œä¸¤æ¬¡evaluated

  * `&&` åˆè¢«ç§°ä¸º `guard operator` æˆ– `short circuiting`

  * è™½ç„¶`&&` å’Œ `||`è¿”å›çš„æ˜¯å®ƒä»¬çš„æ“ä½œæ•°, ä½†æ˜¯åœ¨if(...)ã€while(...) ç­‰è¯­å¥ä¸­, æœ€ç»ˆä¼šå°†å®ƒä»¬è¿”å›çš„æ“ä½œæ•°å†ä¸€æ¬¡éšå¼è½¬æ¢æˆ`boolean`

----

## Symbolçš„è½¬æ¢(Symbol Coercion)
- å¯¹äºè½¬æ¢`string`ç±»å‹, èƒ½å¤Ÿæ˜¾ç¤ºçš„è½¬æ¢, ä½†æ˜¯å¯¹å…¶è¿›è¡Œéšå¼è½¬æ¢åªä¼šå¾—åˆ°é”™è¯¯
  ```javascript
  const s1 = Symbol('test');

  String(s1); // 'Symbol(test)'
  s1 + ''; // TypeError
  ```
  ![avatar](./assets/coercion_symbol_err_str.png)

- å¯¹äºè½¬æ¢`number`ç±»å‹, éƒ½ä¼šæŠ¥é”™
  ```javascript
  const s2 = Symbol(2);

  Number(s2); // TypeError
  +s2; // TypeError
  ```
  ![avatar](./assets/coercion_symbol_err_num.png)

- å¯¹äºè½¬æ¢`boolean`ç±»å‹, åˆ™éƒ½å…è®¸
  ```javascript
  const s3 = Symbol(true);

  Boolean(s3); // true
  !s3; // false
  ```

----

## æ¾æ¯”è¾ƒå’Œä¸¥æ ¼æ¯”è¾ƒ(Loose Equals vs. Strict Equals)
- ä¸€ä¸ªå¸¸è§çš„é”™è¯¯çš„æ¦‚å¿µæ˜¯: `==` æ£€æµ‹çš„æ˜¯å€¼ç›¸ç­‰, `===` æ£€æµ‹å€¼å’Œç±»å‹ç›¸ç­‰...ä½†æ­£ç¡®çš„è§£é‡Šæ˜¯: `==` åœ¨æ£€æµ‹ä¸­å…è®¸ç±»å‹è½¬æ¢, `===` åˆ™ä¸å…è®¸, å®ƒä»¬éƒ½è¿›è¡Œäº†ç±»å‹æ£€æŸ¥, åŒºåˆ«åªä¸è¿‡æ˜¯å…ä¸å…è®¸ç±»å‹ä¸åŒè€Œå·²

- å¦‚æœæ¯”è¾ƒçš„ç›¸åŒç±»å‹çš„å€¼, é‚£ä¹ˆ`==` å’Œ `===` ä½¿ç”¨ç›¸åŒçš„ç®—æ³•

- å¦‚æœæ¯”è¾ƒä¸åŒç±»å‹çš„å€¼, è™½ç„¶åœ¨è¡¨ç°å’Œç®—æ³•æœ‰å·®å¼‚, ä½†è¿™ä¸æ˜¯é‡ç‚¹(å¾ˆå¯èƒ½åªæ˜¯å‡ å¾®ç§’çš„å·®è·), å…³æ³¨ç‚¹åº”è¯¥æ˜¯ä½ æ˜¯å¦æƒ³è¦è®©æ¯”è¾ƒçš„å€¼è¿›è¡Œéšå¼è½¬æ¢

### æ¾æ¯”è¾ƒ(==) - æŠ½è±¡ç›¸ç­‰(Abstract Equality)
- `==` æ“ä½œç¬¦çš„è¡Œä¸ºè¢«å®šä¹‰ä¸º"æŠ½è±¡ç›¸ç­‰æ¯”è¾ƒç®—æ³•"(The Abstract Equality Comparison Algorithm)

- ES5 æ¡æ¬¾11.9.3.1(ES5 spec section 11.9.3)æŒ‡å‡º: `==` å¯¹äºç±»å‹ç›¸ç­‰çš„åŸå§‹å€¼æ¯”è¾ƒæ—¶, åŸºæœ¬èƒ½ç¬¦åˆä½ çš„é¢„æœŸ, é™¤äº†: 
  - `NaN == NaN; //false`
  - `-0 == 0; // true`

- `==` å’Œ `===` å¯¹äºå¤æ‚ç±»å‹çš„å€¼æ¯”è¾ƒæ—¶, ä¸ä¼šè¿›è¡Œä»»ä½•çš„ç±»å‹è½¬æ¢, åªæœ‰å½“å®ƒä»¬çš„**åœ°å€å¼•ç”¨**ç›¸ç­‰æ—¶æ‰ç›¸ç­‰

- `!=` å’Œ `!==` çš„è¿ç®—è¿‡ç¨‹æ˜¯å…ˆè°ƒç”¨ `==` æˆ– `===`, ç„¶åå°†ç»“æœå–å(negation of the result)

#### Comparing - å­—ç¬¦ä¸² vs æ•°å­—
- ä¸‹é¢è¿™æ®µä»£ç , åœ¨`a == b;` ä¸­, åˆ°åº•æ˜¯ `a` è½¬æ¢æˆå­—ç¬¦ä¸²è¿˜æ˜¯ `b` è½¬æ¢æˆæ•°å­—?
  ```javascript
  var a = 42;
  var b = '42';

  a == b; // true
  a === b; // false
  ```

- åœ¨ES5 11.9.3.4-5æ¡æ¬¾ä¸­ï¼šå¦‚æœç±»å‹æ˜¯*æ•°å­—*å’Œ*å­—ç¬¦*æ¯”è¾ƒ, é‚£ä¹ˆå…ˆå°†**å­—ç¬¦è½¬æ¢æˆæ•°å­—**, å¹¶ä¸åŒºåˆ†åœ¨  `==` è¿ç®—ç¬¦çš„å·¦ä¾§è¿˜æ˜¯å³ä¾§

#### Comparing - Anything vs å¸ƒå°”å€¼
- æ ¹æ®ES5 11.9.3.6-7æ¡æ¬¾ä¸­å£°æ˜ï¼šå¦‚æœæœ‰ä¸€ä¸ªæ“ä½œæ•°æ˜¯çš„ç±»å‹æ˜¯*å¸ƒå°”å€¼*ï¼Œé‚£ä¹ˆå¸ƒå°”å€¼ä¼šè¢«ä¼˜å…ˆ**è½¬æ¢æˆæ•°å­—**ï¼Œæ— è®ºå¸ƒå°”å€¼æ˜¯åœ¨ `==` çš„å·¦ä¾§è¿˜æ˜¯å³ä¾§
  ```javascript
  var a = '25';
  var b = true;

  /* ä¸‹é¢çš„è¡¨è¾¾å¼è¿è¡Œè¿‡ç¨‹æ˜¯ï¼š
      * å…ˆå°† b è½¬æˆæ•°å­— 1
      * è¡¨è¾¾å¼å˜æˆäº† 1 == '25'
      * ç±»å‹ä¾æ—§ä¸åŒï¼Œç»§ç»­éšå¼è½¬æ¢
      * æ ¹æ® å­—ç¬¦ä¸² å’Œ æ•°å­— æŠ½è±¡æ¯”è¾ƒçš„è§„åˆ™
      * å°† å­—ç¬¦ä¸²è½¬æˆæˆæ•°å­—
      * è¡¨è¾¾å¼å˜æˆäº† 1 == 25
      * æ˜¾ç„¶å®ƒä»¬å€¼ä¸ç›¸ç­‰ï¼Œè¿”å›false
  */
  a == b; //false
  ```

  ```javascript
  var x = 0;
  var y = 1;
  var z1 = true;
  var z2 = false;

  // æŒ‰ç…§ä¸Šé¢æ‰€è¿°è§„åˆ™ï¼Œä¸‹é¢çš„è¡¨è¾¾å¼ç»“æœä¹Ÿä¸è¶³ä¸ºå¥‡äº†
  x == z2; // true
  y == z1; // true
  ```

- å› æ­¤åœ¨`if(...)`ä¸­ä½¿ç”¨ `==` è¿›è¡Œåˆ¤æ–­ *truthy* æˆ– *falsy* æ˜¯ä¸ç†æ™ºçš„è¡Œä¸ºï¼Œå®è‚¯ç”¨ `!!`ã€`Boolean(...)`ä»£æ›¿
  ```javascript
  var a = '22';
  
  // è„‘å­ç§€é€—äº†çš„è¡Œä¸º
  if (a == true) {
    // ...
  }; 

  // æ­£å¸¸çš„åšæ³•
  if (a) {
    // ...
  };

  // æ˜¾ç¤ºè½¬æ¢ç±»å‹ï¼Œæ›´æ¸…æ™°(å†—ä½™)
  if (!!a) {
    // ...
  };
  if (Boolean(a)) {
    // ...
  };
  ```

#### Comparing - `null`s vs `undefined`s
- æ ¹æ®ES5æ¡æ¬¾ 11.9.3.2-3è§„å®šï¼šå¦‚æœåœ¨ `==` çš„ä¸¤æ–¹çš„æ“ä½œæ•°æ˜¯`null` å’Œ `undefined`ï¼Œæ— è®ºå®ƒä»¬çš„é¡ºåºï¼Œéƒ½å¾—åˆ°`true`

- `null` å’Œ `undefined` å’Œå…¶ä»–çš„falsyè¿›è¡Œæ¾æ¯”è¾ƒæ—¶ï¼Œè¡¨ç°ä¹Ÿç¬¦åˆé¢„æœŸï¼š
  ```javascript
  var a = null;
  var b;

  a == b; // true
  a == null; // true
  b == null; // true
  a == undefined; // true
  b == undefined; // true

  a == false; // false
  b == false; // false
  a == ''; // false
  b == ''; // false
  a == 0; // false
  b == 0; // false
  ```

- åœ¨ä¸‹é¢çš„åœºæ™¯ä¸­ä½¿ç”¨æ¾æ¯”è¾ƒ `==` æ˜¾å¾—æ›´ä¸ºåˆç†ï¼š
  ```javascript
  const res = foo();

  if (a == null) {
    // do someting...
  };

  if (a === null || a === undefined) {
    // do someting...
  };
  ```

#### Comparing - å¯¹è±¡ç±»å‹ vs éå¯¹è±¡ç±»å‹
- æ ¹æ®ES5 11.9.3.8-8æ¡æ¬¾æŒ‡å‡ºï¼šæ¾æ¯”è¾ƒ `==` ä¸­ï¼Œå¦‚æœä»»æ„ä¸€è¾¹çš„æ“ä½œæ•°æ˜¯å¤æ‚ç±»å‹(`array`ã€`function`ã€ `object`...) ç±»å‹ï¼Œå¦ä¸€è¾¹æ˜¯åŸå§‹ç±»å‹(`string`ã€`number`ï¼Œ`boolean`...)ï¼š
  - å¦‚æœåŸå§‹ç±»å‹æ˜¯`string`æˆ–`number`ï¼Œé‚£ä¹ˆä¼šå…ˆå°†å¤æ‚ç±»å‹è½¬æ¢æˆåŸå§‹å€¼ï¼Œç„¶åå†è¿›è¡Œæ¯”è¾ƒ

  - å¦‚æœåŸå§‹ç±»å‹æ˜¯`boolean`ï¼Œé‚£ä¹ˆä¼šéµå¾ª11.9.3.6-7æ¡æ¬¾ï¼Œå…ˆå°†`boolean`è½¬æ¢æˆæ•°å­—ï¼Œå†å¯¹å¤æ‚ç±»å‹è¿›è¡Œè½¬æ¢åæ¯”è¾ƒ

  - å¦‚æœå¤æ‚ç±»å‹æ˜¯åŒ…è£…å¯¹è±¡ï¼Œæ¯”å¦‚`new String(123)`ï¼Œåˆ™ä¼šå…ˆå°†å…¶åŸå§‹å€¼å–å‡ºåï¼Œå†å’Œå¦ä¸€è¾¹çš„åŸå§‹å€¼è¿›è¡Œæ¯”è¾ƒ
    ```javascript
    var a = 'abc';
    var b = Object(a);

    a === b; // false
    a == b; // true
    ```

  - ä½†æ˜¯ä¹Ÿæœ‰ä¸€äº›ç‰¹ä¾‹ï¼š
    ```javascript
    // null å’Œ undefined æ²¡æœ‰åŒ…è£…å¯¹è±¡ï¼Œå› æ­¤Object(null) å’Œ Object(undefined) å®é™…ä¸Šæ˜¯ Object()
    var a = null;
    var b = Object(a);

    a == b; // false

    var c = undefined;
    var d = Object(c);

    c == d; // false

    // NaN èƒ½å¤Ÿè¢«åŒ…è£…æˆNumberå¯¹è±¡ï¼Œä½†æ˜¯NaNæ˜¯å”¯ä¸€ä¸€ä¸ªå’Œè‡ªèº«ä¸ç›¸ç­‰çš„å€¼ï¼Œå› æ­¤NaN == NaN è¿”å› false
    var e = NaN;
    var f = Object(e);

    e == f; // false
    ```

### æç«¯æƒ…å†µ(edge/corner cases)
- ä¸‹é¢çš„ä¾‹å­éå¸¸æç«¯ï¼Œç°å®çš„ä»£ç ä¸­è‚¯å®šä¸ä¼šå‡ºç°ï¼Œä½†è¿™ä¹Ÿæ˜¯ä½¿ç”¨ `==` æ¾æ¯”è¾ƒæ—¶å¯èƒ½å‘ç”Ÿçš„ä¸€ç§æç«¯æƒ…å†µï¼š
  ```javascript
  Number.prototype.valueOf = () => 3;

  // å¦‚æœå‘ç”Ÿè¿™æ ·çš„æƒ…å†µä¸æ˜¯è¯´æ˜éšå¼è½¬æ¢æ˜¯æ¶é­”ï¼Œè€Œæ˜¯è¯´æ˜å¼€å‘è€…æ˜¯è ¢è´§
  new Number(5) == 3; // true
  ```

- éšæ„åœ°ä¿®æ”¹ `valueOf()` å†…å»ºæ–¹æ³•è¿˜èƒ½åšæ›´æ¶å¿ƒçš„äº‹æƒ…ï¼š
  ```javascript
  var i = 2;
  Number.prototype.valueOf = () => i++;

  var num = new Number(10);

  // coercion: å‘ç”Ÿè¿™æ ·çš„äº‹æƒ…æˆ‘ä»¬ä¹Ÿä¸æ„¿æ„ï¼Œä½†è°è®©ä½ TMä¹±åŠ¨valueOf?
  if (num == 2 && num == 3) {
    console.log('ç‹å¾·å‘!')
  }
  ```

#### å„ç§ `falsy` çš„æ¯”è¾ƒ
- åœ¨è¯¸å¤šçš„éšå¼è½¬æ¢ä¸­ï¼Œæœ€é¥±å—è¯Ÿç—…çš„å½“å± `==` è¿ç®—ç¬¦å¯¹äºå„ç§ `falsy` çš„æ¯”è¾ƒäº†ï¼š
  ```javascript
  '0' == null; // false
  '0' == undefined; // false
  '0' == false; // true troublesome
  '0' == NaN; // false
  '0' == 0; // true
  '0' == ''; // false

  false == null; // false
  false == undefined; // false
  false == NaN; // false
  false == 0; // true troublesome
  false == ''; // true troublesome
  false == []; // true troublesome
  false == {}; // false

  '' == null; // false
  '' == undefined; // false
  '' == NaN; // false
  '' == 0; // true troublesome
  '' == []; // true troublesome
  '' == {}; // false

  0 == null; // false
  0 == undefined; // false
  0 == NaN; // false
  0 == []; // true troublesome
  0 == {}; // false
  ```
  ä¸Šé¢ä¸€å…±æœ‰24ç§å…³äºå„ç§ `falsy` çš„æ¾æ¯”è¾ƒï¼Œå…¶ä¸­çš„17ä¸ªæ˜¯ç¬¦åˆé¢„æœŸçš„ï¼Œä½†å‰©ä½™çš„7ä¸ªåº”è¯¥æåŠ›é¿å…åœ¨ä»£ç ä¸­å‡ºç°ï¼š
    - `'0' == false`
    - `false == 0`
    - `false == ''`
    - `false == []`
    - `'' == 0`
    - `'' == []`
    - `0 == []`

#### ç–¯ç‹‚çš„Coercion
- åœ¨ä½ çš„è„‘æµ·ä¸­ï¼Œä¸€å®šè®¤ä¸ºä¸€ä¸ªå€¼è¦ä¹ˆæ˜¯ `truthy` è¦ä¹ˆæ˜¯ `falsy`ï¼Œä½†æ˜¯ä¸‹é¢çš„ä»£ç ä¼šè®©ä½ æ€€ç–‘äººç”Ÿï¼š
  ```javascript
  [] == ![]; //true
  ```
  ä½†å®é™…ä¸Šå‘ç”Ÿçš„æƒ…å†µæ˜¯ï¼š
  - `!` ä¸€å…ƒè¿ç®—ç¬¦æ˜¾ç¤ºçš„å°† `[]` è½¬æ¢æˆäº† `false`
  - åœ¨è¿›è¡Œæ¾æ¯”è¾ƒ `==` æ—¶ï¼Œæ­¤æ—¶ä¸¤è¾¹çš„æ“ä½œæ•°å·²ç„¶æ˜¯`[] == false`ï¼Œå› æ­¤ç»“æœä¸º `true` ä¸€ç‚¹ä¹Ÿä¸å¥‡æ€ª

- ä½ ä¼šå‘ç°å¯¹äºæ•°ç»„çš„ `[]` æ¾æ¯”è¾ƒè¿˜æœ‰å¾ˆå¤šé¢ è¦†æˆ‘ä»¬ä¸‰è§‚çš„å­˜åœ¨ï¼š
  ```javascript
  [2] == 2; // true
  [1] == true; // true
  [2] == true; // false
  [0] == false; // true
  [0] == true; // false
  [NaN] == 'NaN'; // true

  [null] == ''; // true
  [null] == false; // true
  [null] == null; // false âœ…safety

  [undefined] == ''; // true
  [undefined] == false; // true
  [undefined] == undefined; // false âœ…safety
  ```
  è€Œå‘ç”Ÿè¿™ä¸€åˆ‡çš„ç½ªé­ç¥¸é¦–å¹¶ééšå¼è½¬æ¢ï¼æ ¹æºåœ¨äºéšå¼åœ¨äºæ¾æ¯”è¾ƒ `==` å¯¹ *æ•°ç»„ç±»å‹* çš„å€¼è¿›è¡Œéšå¼è½¬æ¢è§„åˆ™ï¼Œè¿›ä¸€æ­¥è®²ï¼Œ**çœŸæ­£çš„é—®é¢˜**å‡ºè‡ªäº `String(...)` æ–¹æ³•æœ¬èº«ï¼š
    - é¦–å…ˆï¼Œå¦‚æœå¦ä¸€æ–¹çš„æ“ä½œæ•°æ˜¯åŸå§‹å€¼ï¼Œé‚£ä¹ˆä¼šå…ˆè°ƒç”¨æ•°ç»„çš„ `valueOf(...)` æ–¹æ³•ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹å¾—åˆ°çš„ä¾ç„¶æ˜¯è¯¥æ•°ç»„æœ¬èº«

    - è€Œåï¼Œä¼šå¯¹è°ƒç”¨æ•°ç»„çš„ `toString(...)` çš„æ–¹æ³•ï¼š
      - æ­¤æ—¶å¦‚æœæ•°ç»„ä¸­çš„æŸé¡¹å­˜åœ¨ `null`ã€`undefined` çš„å€¼é‚£ä¹ˆä¼šè¢«è½¬æ¢æˆç©ºå­—ç¬¦ä¸² `''`

      - å¦‚æœæ˜¯å…¶ä»–çš„åŸå§‹å€¼(`Symbol` é™¤å¤–)ï¼Œåˆ™ä¼šç¬¦åˆé¢„æœŸçš„è½¬æ¢æˆç›¸åº”çš„å­—ç¬¦ä¸²

      - å¦‚æœæ˜¯å¯¹è±¡ç±»å‹çš„å€¼ï¼Œåˆ™ä¼šè°ƒç”¨ `Object.prototype.toString` æ–¹æ³•ï¼Œè½¬æ¢æˆ `[object Object]` çš„å­—ç¬¦ä¸²

      - **ç‰¹åˆ«æ³¨æ„**ï¼šå¦‚æœæ•°ç»„ä¸­å«æœ‰ `Symbol` ç±»å‹çš„å€¼ï¼Œåˆ™ä¼šæŠ¥é”™ï¼š
        ```javascript
        var a = Symbol('test');

        a; // Symbol(test)
        [a] === 'test'; // false âœ…safety
        [a] == 'test'; // âŒTypeError
        ```
        ![avatar](./assets/coercion_==_err_arr_symbol.png)

    - æœ€åï¼Œå˜æˆäº†å­—ç¬¦ä¸²å’ŒåŸå§‹ç±»å‹è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç±»å‹ä¸åŒï¼Œåˆ™è¿›è¡Œç¬¦åˆå„è·¯ES5æ¡æ¬¾çš„éšå¼è½¬æ¢åæ¯”è¾ƒæœ€ç»ˆå€¼

- å¦ä¸€ä¸ªæƒ…å†µæ˜¯é’ˆå¯¹æ‰€æœ‰çš„ç©ºç™½å­—ç¬¦(`''`ã€`'\n'`ã€`' '`)è½¬æ¢æˆæ•°å­—çš„æ—¶å€™å…¶ç»“æœéƒ½æ˜¯ `0`
  ```javascript
  '' == 0; // true
  ' ' == 0; // true
  '\n' == 0; // true
  '\r' == 0; // true

  '' == false; // true
  ' ' == false; // true
  '\n' == false; // true
  '\r' == false; // true

  Number(''); // 0
  Number(' '); // 0
  Number('\n'); // 0
  Number('\r'); // 0
  ```

#### ç†æ™ºåœ°æ€è€ƒ `==`
- å¸‚é¢ä¸Šå„ç§æµè¡Œçš„JSæ•™ç§‘ä¹¦(textbook)ä¼šè®©ä½ ç›´æ¥æŠ›å¼ƒ(throwing the baby out with the bathwater) `==` ï¼Œä½†æ˜¯çœŸçš„ä»…ä»…å› ä¸º **7** ä¸ª(è§ä¸Š)ä¸ç¬¦åˆå¸¸ç†çš„ç»“æœå°±è¦å…¨ç›˜å¦è®¤ `==` ä¹ˆï¼Ÿ

- å›é¡¾ä¸€ä¸‹ä¸Šé¢çš„ **7** ä¸ªä»¤äººä¸çˆ½çš„æ¾æ¯”è¾ƒï¼Œå¾ˆéš¾ä¸å‘ç°å…¶ä¸­å­˜åœ¨çš„è§„å¾‹ï¼š
  - æœ‰ **4** ä¸ªéƒ½æ˜¯å’Œ `false` è¿›è¡Œæ¯”è¾ƒï¼š
    - `'0' == false`
    - `false == 0`
    - `false == ''`
    - `false == []`

  - è¿˜æœ‰ **2** ä¸ªæ˜¯æ¶‰åŠåˆ°(ç©º)æ•°ç»„çš„ `toString(...)` æ–¹æ³•äº§ç”Ÿçš„æ€ªå¼‚ç»“æœ
    - `'' == []`
    - `0 == []`

  - å‰©ä¸‹çš„ **1** ä¸ªåˆ™æ˜¯(ç©º)å­—ç¬¦ä¸²è½¬æ¢æˆæ•°å­— `Number(...)` ç»“æœæ˜¯ `0` çš„é—®é¢˜ï¼š
    - `'' == 0`

#### å®‰å…¨åœ°ä½¿ç”¨ `==`
é™¤å»é‚£æ‰€è°“çš„ä¸è¶³ä¸€å¾®ç§’çš„æ€§èƒ½å·®è·å’Œä¸Šé¢å‡ ç§è®©äººè´¹è§£çš„æ¯”è¾ƒç»“æœä¹‹å¤–ï¼Œä½¿ç”¨ `==` çš„å¥½å¤„æ˜¯æ›´ä¸ºæ˜æ˜¾çš„ï¼›ä½†å‰ææ˜¯ä½ å¿…é¡»éµå®ˆä¸‹é¢ä¸‰æ¡è§„åˆ™ï¼Œå¦åˆ™å‡ºé—¨å³æ‹ğŸ‘‰ `===`
- å¦‚æœ `==` ä¸¤è¾¹çš„æ“ä½œæ•°ä»»ä¸€ä¸€æ–¹å­˜åœ¨ **å¸ƒå°”å€¼**ï¼Œè¯·æ”¾å¼ƒä½¿ç”¨ `==`

- å¦‚æœ `==` ä¸¤è¾¹çš„æ“ä½œæ•°ä»»ä¸€ä¸€æ–¹å­˜åœ¨ï¼š`[]`ã€`''`ã€`0`ï¼Œè®¤çœŸçš„è€ƒè™‘æ˜¯å¦ä½¿ç”¨ `==`

- â—å¦‚æœ `==` ä¸¤è¾¹çš„æ“ä½œæ•°ä»»ä¸€ä¸€æ–¹å­˜åœ¨ **æ•°ç»„**ï¼Œå¹¶ä¸”æ•°ç»„é‡ŒåŒ…å«äº† `Symbol`âŒâŒâŒï¼Œ**ç»å¯¹ä¸è¦ä½¿ç”¨ `==`**

- æœ€åç›—ä¸€å¼ å›¾ï¼Œæ¥è‡ª[Alex Dorey](https://github.com/dorey/JavaScript-Equality-Table)å¯¹äºä¸€äº›å¸¸è§ç±»å‹çš„å€¼åœ¨å’Œè¿™äº›å€¼çš„é›†åˆä¸­è¿›è¡Œé€ä¸€æ¯”è¾ƒçš„ç»“è®ºï¼š
  ![avatar](./assets/coercion_comparsion.png)
  
----

## æŠ½è±¡ç›¸å…³æ¯”è¾ƒ(Abstract Relational Comparison)
- ES5 11.8.5æ¡æ¬¾ä¸­å¯¹äº `a < b` æ¯”è¾ƒåªæœ‰ä¸¤æ¡è§„åˆ™ï¼š
  - ä¸¤è¾¹çš„æ“ä½œæ•°éƒ½æ˜¯å­—ç¬¦ä¸² `string`ï¼Œåˆ™è¿›è¡Œç®€å•çš„è¯å…¸å¼çš„è‡ªç„¶å­—æ¯è¡¨æ¯”å¯¹

  - å…¶ä½™çš„æ“ä½œæ•°ï¼Œåˆ™å…ˆè¿›è¡Œ `ToPrimitive` è½¬æ¢æˆåŸå§‹å€¼ï¼Œè€Œåå¦‚æœç»“æœä¸­ä»»ä½•ä¸€ä¸ªå€¼éƒ½ä¸ä¸º `string` ï¼Œé‚£ä¼šæ¥ç€ `ToNumber` å°†å€¼è½¬æ¢æˆæ•°å­—ç±»å‹è¿›è¡Œæ¯”è¾ƒ

  åŒæ ·çš„é€»è¾‘é€‚ç”¨äº `>`

- åŒªå¤·æ‰€æ€çš„ `>=` å’Œ `<=`
  - `>=` è°ƒç”¨çš„å®é™…è¿‡ç¨‹ï¼šé¦–å…ˆä½¿ç”¨ `<` æ¯”è¾ƒä¸¤è¾¹æ“ä½œæ•°ï¼Œéšåç¿»è½¬(negate)æ¯”è¾ƒçš„ç»“æœä¸ºæœ€ç»ˆçš„ç»“æœ

  - JS å¯¹äº `<=` çš„å®é™…è§£é‡Š **å¹¶éå°äºæˆ–ç­‰äº**ï¼Œè€Œæ˜¯ **ä¸å¤§äº**(`!a > b`)ï¼ŒåŒç†ç”¨äº `>=`ï¼Œå› æ­¤ä¼šåœ¨ä¸‹é¢çš„ä»£ç ä¸­å‡ºç°åŒªå¤·æ‰€æ€çš„ç»“æœï¼š
    ```javascript
    var a = { b: 33 };
    var b = { b: 33 };

    a < b; // false
    a == b; // false
    a > b; // false

    a <= b; // true
    a >= b; // true
    ```

- ä¸å¹¸çš„æ˜¯ï¼ŒJSä¸­ç›®å‰å¹¶æ²¡æœ‰ä¸¥æ ¼çš„ç›¸å…³æ¯”è¾ƒï¼Œå³æ²¡æœ‰ä¸€ç§å†…å»ºçš„æœºåˆ¶èƒ½ç¡®ä¿åœ¨ç›¸å…³æ¯”è¾ƒä¸­ï¼Œå·¦å³çš„æ“ä½œæ•°å¿…é¡»æ˜¯åŒä¸€ç§ç±»å‹çš„å€¼ã€‚å› æ­¤å¦‚æœéšå¼è½¬æ¢åœ¨ç›¸å…³æ¯”è¾ƒä¸­æ˜¯æœ‰å¸®åŠ©çš„ä¸”å®‰å…¨çš„ï¼Œé‚£å°±ç›´æ¥ä½¿ç”¨å®ƒï¼›å¦åˆ™ï¼Œå…ˆä½¿ç”¨æ˜¾ç¤ºè½¬æ¢æ“ä½œæ•°ï¼Œç„¶åå†è¿›è¡Œç›¸å…³æ¯”è¾ƒ