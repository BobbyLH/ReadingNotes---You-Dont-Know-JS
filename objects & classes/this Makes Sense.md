# `this` çœ‹ä¸Šå»æ˜¯é‚£ä¹ˆå›äº‹äº†ï¼(`this` All Makes Sense Now!)
ä¹‹å‰æåŠ `this` çš„ç»‘å®šå–å†³äºå‡½æ•°è°ƒç”¨æ—¶çš„è°ƒç”¨æ¡ä»¶ï¼Œå³å‡½æ•°å¦‚ä½•è¢«è°ƒç”¨ â€”â€” **è°ƒç”¨ç‚¹(call-site)**ã€‚

## è°ƒç”¨ç‚¹(Call-site)
æ‰€è°“ *è°ƒç”¨ç‚¹(call-site)*ï¼Œå³ä»£ç ä¸­å‡½æ•°è°ƒç”¨çš„ä½ç½®(åŒºåˆ«å‡½æ•°å£°æ˜çš„ä½ç½®)ã€‚ä½†ä»…ä»…é€šè¿‡ *å®šä½å‡½æ•°çš„è°ƒç”¨ä½ç½®* æ¥æ‰¾åˆ° *è°ƒç”¨ç‚¹* å¹¶ä¸é‚£ä¹ˆæœ‰æ•ˆï¼Œå› ä¸ºæœ‰äº›ä¹¦å†™ä»£ç çš„æ¨¡å¼ä¼šå°†å…¶æ©ç›–èµ·æ¥ã€‚

å¦ä¸€ä¸ªé‡è¦çš„æ¦‚å¿µæ˜¯ *è°ƒç”¨æ ˆ(call-stack)* â€”â€” å½“å‰å‡½æ•° *æ‰§è¡Œæ—¶* çš„å·²è°ƒç”¨çš„æ ˆã€‚

ğŸ‘‡ *è°ƒç”¨ç‚¹* å’Œ *è°ƒç”¨æ ˆ*ï¼š
```js
function baz () {
  // call-stack is baz
  // that means call-site is in global scope
  console.log('baz');
  bar();
}

function bar () {
  // call-stack is in baz -> bar
  // that means call-site is in baz
  console.log('bar');
  foo();
}

function foo () {
  // call-stack is in baz -> bar -> foo
  // that means call-site is in bar
  console.log('foo');
}

baz(); // the bar call-site
```

ä» *è°ƒç”¨æ ˆ* ä¸­åˆ†æå‡º *è°ƒç”¨ç‚¹* æ˜¯ä¸ºäº†è·å– `this` çš„ç»‘å®šï¼Œä½ å¯ä»¥ä½¿ç”¨æµè§ˆå™¨è‡ªå¸¦çš„debuggerå·¥å…·ï¼Œæˆ–è€…ç›´æ¥åœ¨ä»£ç é‡Œæ’å…¥ `debugger`ï¼Œæ¥åœ¨ `foo` å‡½æ•°çš„ä½ç½®æ‰“æ–­ç‚¹ï¼Œè€Œååœ¨å¯è§†åŒ–çš„å›¾å½¢ç•Œé¢ä¸­æŸ¥çœ‹ğŸ‘†è¿™æ®µä»£ç çœŸå®çš„è°ƒç”¨æ ˆ(å³ä¾§ç¬¬äºŒè¡Œçš„Call Stack)ï¼š

![avatar](./assets/this_all_makes_sense_now_call_stack.png)

## è§„å®šï¼Œä¸æ˜¯ä¹Œé¾Ÿçš„å±è‚¡(Nothing But Rules)
æƒ³è¦çŸ¥é“ `this` çš„ç»‘å®šæŒ‡å‘ï¼Œæˆ‘ä»¬å¿…é¡»å…ˆæŸ¥çœ‹ *è°ƒç”¨ç‚¹*ï¼Œå¹¶æ ¹æ® **4** ä¸ªæ—¢å®šçš„è§„åˆ™æ¥çŸ¥æ™“ `this` çš„çœŸå®æŒ‡å‘ã€‚

### é»˜è®¤ç»‘å®š(Default Binding)
ç¬¬ä¸€ä¸ªåœºæ™¯æ˜¯æˆ‘ä»¬æœ€ä¸ºç†ŸçŸ¥çš„ï¼Œå³ *å•ç‹¬åœ°è°ƒç”¨æŸä¸ªå‡½æ•°(standalone function invocation)*ã€‚ä½ å¯ä»¥æŠŠè¿™ä¸ªè§„åˆ™ç†è§£æˆå…¶ä»–ç»‘å®šè§„åˆ™éƒ½æ²¡ç”Ÿæ•ˆæ—¶ï¼Œå¯¹äº `this` ç»‘å®šçš„ ç¼ºçœ/é»˜è®¤è§„åˆ™ã€‚

```js
function foo () {
  console.log(this.a);
}

var a = 2;

foo(); // 2
```

ğŸ‘† å…¨å±€çš„å˜é‡å£°æ˜ `var a = 2;` å®é™…ä¸ŠåŒç­‰äºåœ¨ *å…¨å±€å¯¹è±¡(global-object)* ä¸­åŠ å…¥äº†ä¸€ä¸ªå±æ€§å€¼ `a` â€”â€” å®ƒä»¬ä¸æ˜¯äº’ä¸ºå¤åˆ¶å“ï¼Œå®ƒä»¬å°±æ˜¯å½¼æ­¤ï¼Œå®ƒä»¬æ˜¯ä¸€ä¸ªç¡¬å¸çš„ä¸¤é¢ï¼ŒåŒºåˆ«ä»…åœ¨äºçœ‹é—®é¢˜çš„è§’åº¦ä¸åŒè€Œå·²ã€‚

ç´§æ¥ç€ï¼Œæˆ‘ä»¬è°ƒç”¨å‡½æ•° `foo` è€Œåæ‰§è¡Œå…¶ä¸­çš„ä»£ç å— `console.log(this.a);` è·å–åˆ°äº†å˜é‡ `a` çš„å€¼å¹¶å°†ç»“æœæ‰“å°åœ¨æ§åˆ¶å°ä¸Šã€‚ä¸ºä»€ä¹ˆ `this.a` èƒ½å¤Ÿè·å–å˜é‡ `a` çš„å€¼ï¼Ÿ â€”â€” æˆ‘ä»¬å…ˆæŸ¥çœ‹ *è°ƒç”¨ç‚¹(call-site)*ï¼Œå‘ç°å¯¹äºå‡½æ•° `foo` æ˜¯ *å•ç‹¬è°ƒç”¨* çš„ï¼Œåˆ™å¯ä»¥ç¡®è®¤åº”ç”¨çš„æ˜¯é»˜è®¤ç»‘å®šè§„åˆ™ï¼Œå› æ­¤è¿™æ—¶å€™çš„ `this` ç»‘å®šçš„æ˜¯å…¨å±€å¯¹è±¡ã€‚

ä½†å¦‚æœï¼Œæˆ‘ä»¬ä½¿ç”¨äº† *ä¸¥æ ¼æ¨¡å¼(strict mode)* â€”â€” `"use strict";`ï¼Œ`this` çš„é»˜è®¤ç»‘å®šçš„ *å…¨å±€å¯¹è±¡* åˆ™ä¼šè¢«æ›¿æ¢æˆ `undefined`ã€‚

```js
function foo () {
  "use strict";

  console.log(this.a);
}

var a = 2;

foo(); // TypeError
```

æœ‰ä¸ªé‡è¦çš„ç»†èŠ‚ç‚¹ï¼š`this` çš„ç»‘å®šè§„åˆ™è™½ç„¶åŸºäº *è°ƒç”¨ç‚¹*ï¼Œå…¨å±€å¯¹è±¡ä¹Ÿåªä¼šåœ¨é»˜è®¤ç»‘å®šè§„åˆ™ä¸”æ²¡æœ‰è¿è¡Œåœ¨ *ä¸¥æ ¼æ¨¡å¼* æ‰ä¼šç»‘å®šåˆ° `this` ä¸Šã€‚ä½†åœ¨ *è°ƒç”¨ç‚¹* ä¸Šå£°æ˜çš„ *ä¸¥æ ¼æ¨¡å¼*ï¼Œå¹¶ä¸èƒ½å†³å®šåœ¨è¿™ä¸ªç‚¹ä¸Šè°ƒç”¨çš„å‡½æ•°æ˜¯å¦éƒ½éµå¾ª *ä¸¥æ ¼æ¨¡å¼*ï¼š

```js
function foo () {
  console.log(this.a);
}

var a = 2;

(function () {
  "use strict";

  foo(); // 2
})();
```

### éšå¼ç»‘å®š(Implicit Binding)
å¦ä¸€ä¸ª `this` çš„ç»‘å®šè§„åˆ™éœ€è¦å…³æ³¨ï¼šå‡½æ•°çš„ *è°ƒç”¨ç‚¹* æ˜¯å¦æœ‰ *ä¸Šä¸‹æ–‡å¯¹è±¡(context object)*ï¼›æ¢å¥è¯è¯´ï¼Œ*è°ƒç”¨ç‚¹* æ˜¯å¦æ‹¥æœ‰æˆ–åŒ…å«æŸä¸ªå¯¹è±¡ï¼š
```js
function foo () {
  console.log(this.a);
}

var obj = {
  a: 2,
  foo
}

obj.foo(); // 2
```

é¦–å…ˆï¼Œæ— è®ºå‡½æ•° `foo` æ˜¯æå‰å£°æ˜è€Œåè¢«åŠ å…¥åˆ°å¯¹è±¡ `obj` ä¸­çš„ï¼Œè¿˜æ˜¯ `foo` ä¼´éšå¯¹è±¡åˆå§‹åŒ–æ—¶æ‰ä¸€å¹¶å£°æ˜ï¼Œè¿™éƒ½ä¸æ˜¯é‡ç‚¹ã€‚é‡ç‚¹æ˜¯å‡½æ•° `foo` è¢« `obj` æ‰€åŒ…å«ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ç†è§£æˆå¯¹è±¡ `obj` ä¿å­˜äº†å¯¹å‡½æ•° `foo` çš„å¼•ç”¨æŒ‡é’ˆã€‚

`obj.foo();` åœ¨å‡½æ•° `foo` è°ƒç”¨ä¹‹å‰è¿˜æœ‰ä¸€ä¸ªå¯¹äº `obj` çš„å¼•ç”¨ï¼Œè¿™ä¸ª `obj` å°±æ˜¯ä¹‹å‰æåˆ°çš„ *ä¸Šä¸‹æ–‡å¯¹è±¡*ã€‚è€Œè¿™æ­£å¥½ç¬¦åˆ `this` çš„ *éšå¼ç»‘å®š* è§„åˆ™ â€”â€” `this` ç»‘å®šåˆ°å‡½æ•°å¼•ç”¨çš„å¯¹è±¡ `obj` ä¸Šï¼Œå› æ­¤ `this.a` æŒ‡ä»£çš„å°±æ˜¯ `obj.a`ã€‚

å¤šå±‚å¼•ç”¨æ—¶ï¼Œåªæœ‰æœ€åä¸€å±‚çš„å¯¹è±¡å¼•ç”¨æ‰ä¼šç»‘å®šåˆ° `this` ä¸Šï¼š
```js
function foo () {
  console.log(this.a);
}

var obj2 = {
  a: 42,
  foo
};

var obj1 = {
  a: 2,
  obj2
};

obj1.obj2.foo(); // 42
```

#### éšå¼ç»‘å®šçš„ä¸¢å¤±é—®é¢˜(Implicitly Lost)
ä¸€ä¸ªå¸¸è§çš„ä»¤äººå›°æƒ‘åœ¨äº `this` çš„éšå¼ç»‘å®šä¼šä¸¢å¤±ï¼Œå¹¶é€€å›åˆ°é»˜è®¤ç»‘å®šè§„åˆ™ï¼Œå³ `this` è¦ä¹ˆæŒ‡å‘å…¨å±€å¯¹è±¡ï¼Œè¦ä¹ˆæ˜¯ `undefined`ï¼Œè¿™å–å†³äºæ˜¯å¦åº”ç”¨äº† *ä¸¥æ ¼æ¨¡å¼*ğŸ‘‡ï¼š

```js
function foo () {
  console.log(this.a);
}

var obj = {
  a: 2,
  foo
};

var bar = obj.foo;

var a = 'lost binding';

bar(); // "lost binding"
```

ğŸ‘†è™½ç„¶å˜é‡ `bar` æ˜¾ç„¶æ˜¯å¯¹ `obj.foo` çš„å¼•ç”¨ï¼Œä½†æ˜¯å…³é”®ç‚¹è¿˜æ˜¯åœ¨äº *è°ƒç”¨ç‚¹* â€”â€” `bar();` æ˜¾ç„¶æ˜¯ä¸€ä¸ªæ²¡æœ‰ä»»ä½• *ä¸Šä¸‹æ–‡å¯¹è±¡(context object)* çš„å‡½æ•°è°ƒç”¨ï¼Œå› æ­¤ä½¿ç”¨äº†é»˜è®¤è§„åˆ™ä¹Ÿä¸è¶³ä¸ºå¥‡äº†ã€‚

*å›è°ƒå‡½æ•°* æ˜¯å¦ä¸€ä¸ªæ›´å¾®å¦™ã€æ›´æ™®éã€æ›´åé¢„æœŸçš„ä¸¢å¤±éšå¼ç»‘å®šçš„åœºæ™¯ğŸ‘‡ï¼š

```js
function foo () {
  console.log(this.a);
}

var obj = {
  a: 2,
  foo
};

function doFoo (callback) {
  callback && callback();
}

var a = 'lost binding';

doFoo(obj.foo); // "lost binding"
```

ğŸ‘†å‘ `doFoo(obj.foo);` ä¼ é€’å‚æ•°æ—¶ï¼Œè™½ç„¶ `obj.foo` æ˜¯æœ‰å¯¹è±¡çš„å¼•ç”¨ï¼Œä½†å‡½æ•°å¹¶æ²¡æœ‰è¢«è°ƒç”¨ï¼Œæ­¤æ—¶å¹¶ä¸æ˜¯æˆ‘ä»¬æåˆ°çš„ *è°ƒç”¨ç‚¹*ã€‚çœŸæ­£çš„ *è°ƒç”¨ç‚¹* è¿˜æ˜¯ `callback && callback();` â€”â€” æ²¡æœ‰æ¶‰åŠä»»ä½•çš„ *ä¸Šä¸‹æ–‡å¯¹è±¡(context object)*ã€‚

ä½ å¯èƒ½ä¼šæƒ³ï¼Œå¦‚æœæˆ‘ä½¿ç”¨å†…å»ºçš„æ–¹æ³•æ¥å—å›è°ƒçš„æ–¹æ³•ï¼Œæ˜¯å¦æƒ…å†µæœ‰æ‰€æ”¹å˜å‘¢ï¼Ÿï¼š

```js
function foo () {
  console.log(this.a);
}

var obj = {
  a: 2,
  foo
};

var a = 'lost binding';

setTimeout(obj.foo, 1000); // "lost binding"
```

![avatar](./assets/this_all_makes_sense_now_implicit_lose.png)

ç­”æ¡ˆæ˜¾ç„¶æ˜¯ **ä¾ç„¶ä¼šä¸¢å¤±** â€”â€” å…³é”®ä¾ç„¶æ˜¯åœ¨ *è°ƒç”¨ç‚¹* ä¸Šã€‚

### æ˜¾ç¤ºç»‘å®š(Explicit Binding)
äº†è§£äº†é»˜è®¤ç»‘å®šå’Œéšå¼ç»‘å®šçš„è§„åˆ™åï¼Œæœ‰ä¸€éƒ¨åˆ†çš„ `this` æŒ‡å‘åœºæ™¯èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚äº†ï¼Œä½†å¦‚æœæˆ‘ä»¬æƒ³è¦å¼ºåˆ¶å°†æŸä¸ªå‡½æ•°çš„ `this` ç»‘å®šåˆ°æŸä¸ª *ä¸Šä¸‹æ–‡å¯¹è±¡* ä¸Šï¼Œè€Œåˆä¸æƒ³å°†è¿™ä¸ªå‡½æ•°ä½œä¸ºè¿™ä¸ª *ä¸Šä¸‹æ–‡å¯¹è±¡* çš„æŸä¸ªæ–¹æ³•æ¥è°ƒç”¨ï¼Œè¿™æ—¶å€™å°±éœ€è¦ä½¿ç”¨ *æ˜¾ç¤ºç»‘å®š* è§„åˆ™äº†ã€‚

`call(â€¦)` å’Œ `apply(â€¦)` æ˜¯æ¯ä¸ªå‡½æ•°éƒ½å…·å¤‡çš„å†…ç½®æ–¹æ³•ï¼Œå®ƒä»¬çš„ä½¿ç”¨åŸºæœ¬ç±»ä¼¼ï¼Œç¬¬ä¸€ä¸ªå‚æ•°éƒ½æ˜¯ç»‘å®šåˆ° `this` çš„ *ä¸Šä¸‹æ–‡å¯¹è±¡*ï¼Œåé¢çš„åˆ™æ˜¯è°ƒç”¨è¯¥æ–¹æ³•(`call` å’Œ `apply`)çš„å‡½æ•°æ‰€éœ€è¦çš„å‚æ•°ï¼Œå®Œæˆè¿™äº›åï¼Œç«‹å³æ‰§è¡Œè¿™ä¸ªå‡½æ•°ï¼š

```js
function foo () {
  console.log(this.a);
}

var obj = {
  a: 2
};

foo.call(obj); // 2
```

å¦‚æœä½ å°† *åŸå§‹å€¼(primitive value)*(`string`ã€`number`ã€`boolean`) ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥ `call` æˆ– `apply`ï¼Œé‚£ä¹ˆè¿™äº›åŸå§‹å€¼å°†ä¼šè¢«éšå¼è½¬æ¢æˆ *åŒ…è£…å¯¹è±¡*(`new String(â€¦)`ã€`new Number(â€¦)`ã€`new Boolean(â€¦)`)ã€‚

ä½†å¥½åƒæ˜¾ç¤ºç»‘å®šä¹Ÿå¹¶æ²¡æœ‰è§£å†³éšå¼ç»‘å®šä¸¢å¤± `this` çš„é—®é¢˜ï¼Ÿï¼

#### ç¡¬ç»‘å®š(Hard Binding)
å›´ç»•ç€æ˜¾ç¤ºç»‘å®šå®ç°çš„ä¸€ç§ç»‘å®šæ¨¡å¼ï¼Œèƒ½å¤Ÿè§£å†³ä¸¢å¤± `this` çš„é—®é¢˜ï¼š

```js
function foo () {
  console.log(this.a);
}

var obj = {
  a: 2
};

var a = 'lost binding';

function bar () {
  foo.call(obj);
}

setTimeout(bar, 1000);

bar.call(window);
```

ğŸ‘†å‡½æ•° `bar` æ— è®ºæ˜¯ä½œä¸ºå›è°ƒå‡½æ•°ï¼Œè¿˜æ˜¯è‡ªèº«çš„ `this` è¢«æ˜¾ç¤ºçš„ç»‘å®šåˆ°å…¨å±€å¯¹è±¡(`window`)ï¼Œè°ƒç”¨å®ƒéƒ½åªä¼šåœ¨æ§åˆ¶å°æ‰“å°å‡º `2` å³ `obj.a` çš„å€¼ â€”â€” å› ä¸ºå…¶å†…éƒ¨åªä¼šå°† `foo` çš„ `this` æ˜¾ç¤ºçš„ç»‘å®šåˆ° `obj` ä¸Šã€‚è¿™æ ·çš„ç»‘å®šæ¨¡å¼æˆ‘ä»¬ç§°ä¸º *ç¡¬ç»‘å®š*ã€‚

æ”¹è¿›ä¸€ä¸‹ï¼Œä½ å¯ä»¥å°†éœ€è¦è¿›è¡Œç¡¬ç»‘çš„å‡½æ•°å’Œ *ä¸Šä¸‹æ–‡å¯¹è±¡* ä½œä¸ºå‚æ•°ä¼ é€’ï¼š

```js
function foo (num) {
  console.log(this.a, num);

  return this.a + num;
}

function simpleBind (fn, ctx) {
  return function () {
    return fn.apply(ctx, arguments);
  }
}

var obj = {
  a: 2
};

var a = 'lost binding';

var bar = simpleBind(foo, obj);

var b = bar(5); // 2 5
console.log(b); // 7
```

ğŸ‘†ä¸Šé¢ä»£ç ä¸­çš„ `simpleBind` æ˜¯å†…ç½®çš„ `bind` æ–¹æ³•çš„éƒ¨åˆ†åŠŸèƒ½ç®€å•å®ç°ï¼Œå†…ç½®çš„ `bind` æ–¹æ³•ä¸ä»…èƒ½å¤Ÿè¿”å›ä¸€ä¸ªå·²ç»ä¸º `this` ç»‘å®šäº† *ä¸Šä¸‹æ–‡å¯¹è±¡* çš„å‡½æ•°ï¼Œå¹¶ä¸”è¿™ä¸ªå‡½æ•°è¿˜æœ‰ä¸€ä¸ª `name` å±æ€§çš„å€¼ä¸º `bound foo`ï¼Œå³ç»‘å®šäº† `this` çš„å‡½æ•° `foo`ã€‚

#### APIè°ƒç”¨çš„ â€œä¸Šä¸‹æ–‡â€(API Call "Context")
å¾ˆå¤šç¬¬ä¸‰æ–¹åº“çš„æ–¹æ³•ï¼Œç”šè‡³æ˜¯ä¸€äº›å†…ç½®çš„æ–¹æ³•ï¼Œæä¾›äº†å¯é€‰å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°ä¼šè®©ä½ ä¼ é€’ *ä¸Šä¸‹æ–‡å¯¹è±¡* æ¥ç»‘å®šåˆ°å›è°ƒå‡½æ•° `this` ä¸Šï¼š

```js
function foo (ele) {
  console.log(ele, this.id);
}

var obj = {
  id: 'awesome'
};

[1, 2, 3].forEach(foo, obj); // 1 "awesome" 2 "awesome" 3 "awesome"
```

ä»æœ¬è´¨ä¸Šæ¥è¯´ï¼Œè¿™äº›æ–¹æ³•éƒ½é‡‡ç”¨äº†æ˜¾ç¤ºç»‘å®šçš„è§„åˆ™ï¼Œå³ä½¿ç”¨ `call` å’Œ `apply` å†…ç½®æ–¹æ³•æ¥å¸®ä½ é¿å…ä¸€äº›éº»çƒ¦ã€‚

## `new` ç»‘å®š(`new` Binding)
ç¬¬å››ä¸ªï¼Œä¹Ÿæ˜¯æœ€åä¸€ä¸ª `this` çš„ç»‘å®šè§„åˆ™ï¼Œéœ€è¦æˆ‘ä»¬é‡æ–°æ€è€ƒJSä¸­çš„å‡½æ•°å’Œå¯¹è±¡ï¼Œä»¥åŠå…³äºå®ƒä»¬å¸¸è§çš„è¯¯åŒºã€‚

åœ¨ä¼ ç»Ÿçš„é¢å‘å¯¹è±¡çš„è¯­è¨€ä¸­ï¼Œé€šå¸¸ä½¿ç”¨å…³é”®å­— `new` æ¥å®ä¾‹åŒ–ä¸€ä¸ªç±»ï¼Œè¿™ä¸ªå…³é”®å­—åœ¨JSä¸­ä¹ŸåŒæ ·å­˜åœ¨ã€‚ä½†JSä¸­ä½¿ç”¨å…³é”®å­— `new` è™½ç„¶çœ‹ä¸Šå»è·Ÿé¢å‘å¯¹è±¡çš„è¯­è¨€ä¸€æ ·ï¼Œå¥½åƒéƒ½å®ä¾‹åŒ–äº†ä¸€ä¸ªç±»ï¼Œä½†è¿™åªæ˜¯ä¸€ä¸ªå‡è±¡ã€‚

é¦–å…ˆï¼ŒJSä¸­æ‰€è°“çš„ *æ„é€ å™¨(constructor)* åªæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œåœ¨å…¶å‰é¢ä½¿ç”¨äº†å…³é”®å­— `new` æ¥è°ƒç”¨å®ƒè€Œå·²ã€‚å®ƒå¹¶éä¸€ä¸ªç±»ï¼Œä¹Ÿä¸æ˜¯å®ä¾‹åŒ–è¿™ä¸ªç±»ï¼Œå®ƒç”šè‡³éƒ½ä¸æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å‡½æ•° â€”â€” é™¤äº†ä½¿ç”¨ `new` æ¥ *åŠ«æŒ(hijacked)* å®ƒçš„è°ƒç”¨ï¼Œå®ƒæœ¬è´¨ä¸Šå’Œæ™®é€šçš„å‡½æ•°æ²¡ä»€ä¹ˆä¸¤æ ·ã€‚

æ¯”å¦‚ï¼Œå†…ç½®çš„ `Number(â€¦)` æ„é€ å‡½æ•°ï¼Œåœ¨ES5çš„è¯´æ˜æ–‡æ¡£é‡Œï¼Œå¯¹å…¶æœ‰æ¸…æ™°çš„å®šä¹‰ï¼š
> 15.7.2 The Number Constructor
> 
> When Number is called as part of a new expression it is a constructor: it initialises the newly created object.

JSä¸­å¹¶æ²¡æœ‰æ‰€è°“çš„ *æ„é€ å™¨å‡½æ•°(constructor functions)*ï¼Œåªæœ‰ *å‡½æ•°çš„æ„é€ è°ƒç”¨(construction calls of functions)*ã€‚

å½“å‡½æ•°å‰ä½¿ç”¨äº† `new` å…³é”®å­—æ—¶ï¼Œå‘ç”Ÿäº†å¦‚ä¸‹çš„äº‹æƒ…ï¼š
1. å‡­ç©ºåˆ›é€ äº†æ–°å¯¹è±¡ï¼Œå¹¶å°†å…¶å…³è”åˆ° *åŸå‹(prototype)* ä¸Šï¼›
2. è¿™ä¸ªæ–°å¯¹è±¡è¢«ç»‘å®šä¸ºè¿™ä¸ªå‡½æ•°ä¸­çš„ `this` çš„ *ä¸Šä¸‹æ–‡å¯¹è±¡*ï¼›
3. é™¤éå‡½æ•°æ‰‹åŠ¨çš„è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå¦åˆ™å°±è¿™ä¸ªæ–°åˆ›å»ºçš„å¯¹è±¡ä¼šè¢«è¿”å›ã€‚

```js
function foo (a) {
  this.a = a;
}

var bar = new foo(a);

console.log(bar.a); // 2
```

`new` æ˜¯å‡½æ•°è°ƒç”¨æ—¶èƒ½å¤Ÿç»‘å®š `this` çš„æœ€åä¸€ç§æ–¹å¼ï¼Œæˆ‘ä»¬ç§°å…¶ä¸º *new ç»‘å®š*ã€‚

## ä¸€åˆ‡éƒ½äº•ç„¶æœ‰åº(Everything In Order)